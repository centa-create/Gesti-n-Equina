<ion-header>
  <ion-toolbar class="professional-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title class="professional-title">
      <ion-icon name="paw" class="title-icon"></ion-icon>
      Gesti칩n de Caballos
    </ion-title>
    <ion-buttons slot="end" *ngIf="canEdit">
      <ion-button fill="solid" color="primary" (click)="toggleForm()" class="add-button">
        <ion-icon name="add" slot="start"></ion-icon>
        Nuevo Caballo
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="professional-content">
  <!-- Filtros avanzados -->
  <div class="filters-section">
    <app-advanced-filters
      [config]="filtrosConfig"
      [values]="filtrosValues"
      [isExpanded]="filtrosExpanded"
      (valuesChange)="onFiltrosChange($event)"
      (toggle)="onFiltrosToggle($event)"
      (clear)="onFiltrosClear()"
      (apply)="onFiltrosApply($event)">
    </app-advanced-filters>
  </div>

  <!-- Dashboard de Estad칤sticas -->
  <div class="dashboard-section" *ngIf="caballosFiltrados.length > 0">
    <h2 class="section-title">游늵 Panel de Control</h2>
    <div class="stats-dashboard">
      <ion-card class="stat-card total premium-glow">
        <ion-card-content>
          <div class="stat-header">
            <ion-icon name="paw" color="primary"></ion-icon>
            <span class="stat-label">Total Caballos</span>
          </div>
          <div class="stat-value">{{ caballosFiltrados.length }}</div>
          <div class="stat-subtitle">{{ filtrosValues['estado'] ? filtrosValues['estado'] + 's' : 'registrados' }}</div>
        </ion-card-content>
      </ion-card>

      <ion-card class="stat-card gender premium-float">
        <ion-card-content>
          <div class="stat-header">
            <ion-icon name="male-female" color="secondary"></ion-icon>
            <span class="stat-label">Distribuci칩n por G칠nero</span>
          </div>
          <div class="stat-value">{{ getEstadisticasGenero().machos + getEstadisticasGenero().hembras }}</div>
          <div class="stat-subtitle">{{ getEstadisticasGenero().machos }} Machos / {{ getEstadisticasGenero().hembras }} Hembras</div>
        </ion-card-content>
      </ion-card>

      <ion-card class="stat-card age premium-morph">
        <ion-card-content>
          <div class="stat-header">
            <ion-icon name="calendar" color="tertiary"></ion-icon>
            <span class="stat-label">Edad Promedio</span>
          </div>
          <div class="stat-value">{{ getEdadPromedio() }}</div>
          <div class="stat-subtitle">a침os promedio</div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- Galer칤a de Caballos -->
  <div class="horses-section">
    <h2 class="section-title" *ngIf="caballosFiltrados.length > 0">游냁 Caballos Registrados</h2>

    <div class="horses-grid" *ngIf="caballosFiltrados.length > 0">
      <ion-card class="horse-card premium-glow" *ngFor="let caballo of caballosFiltrados">
        <ion-card-header class="horse-header">
          <div class="horse-avatar">
            <ion-icon [name]="caballo.sexo === 'macho' ? 'male' : 'female'" [color]="caballo.sexo === 'macho' ? 'primary' : 'tertiary'"></ion-icon>
          </div>
          <div class="horse-info">
            <ion-card-title class="horse-name">{{ caballo.nombre }}</ion-card-title>
            <ion-card-subtitle class="horse-subtitle">
              <span class="breed">{{ caballo.raza || 'Sin raza especificada' }}</span>
            </ion-card-subtitle>
          </div>
          <div class="horse-status">
            <span class="status-badge" [class]="'status-' + caballo.estado">
              {{ caballo.estado | titlecase }}
            </span>
          </div>
        </ion-card-header>

        <ion-card-content class="horse-details">
          <div class="detail-grid">
            <div class="detail-item">
              <ion-icon name="calendar-outline" color="medium"></ion-icon>
              <span>{{ getEdad(caballo.fechaNacimiento) }}</span>
            </div>
            <div class="detail-item">
              <ion-icon name="color-palette-outline" color="medium"></ion-icon>
              <span>{{ caballo.pelaje || 'No especificado' }}</span>
            </div>
            <div class="detail-item" *ngIf="caballo.nombreCriadero">
              <ion-icon name="business-outline" color="medium"></ion-icon>
              <span>{{ caballo.nombreCriadero }}</span>
            </div>
          </div>

          <div class="horse-lineage" *ngIf="getPadre(caballo) || getMadre(caballo)">
            <h4>Linaje</h4>
            <div class="lineage-info">
              <span *ngIf="getPadre(caballo)">
                <strong>Padre:</strong> {{ getPadre(caballo)?.nombre }}
              </span>
              <span *ngIf="getMadre(caballo)">
                <strong>Madre:</strong> {{ getMadre(caballo)?.nombre }}
              </span>
            </div>
          </div>

          <div class="horse-actions" *ngIf="canEdit">
            <ion-button fill="clear" color="primary" size="small" (click)="editarCaballo(caballo); $event.stopPropagation()">
              <ion-icon name="create" slot="start"></ion-icon>
              Editar
            </ion-button>
            <ion-button fill="clear" color="danger" size="small" (click)="eliminarCaballo(caballo.id); $event.stopPropagation()">
              <ion-icon name="trash" slot="start"></ion-icon>
              Eliminar
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- Formulario Profesional para agregar/editar caballo -->
  <div class="form-section" *ngIf="showForm && canEdit">
    <ion-card class="form-card premium-glow">
      <ion-card-header class="form-header">
        <ion-card-title class="form-title">
          <ion-icon [name]="nuevoCaballo.id ? 'create' : 'add'" class="form-icon"></ion-icon>
          {{ nuevoCaballo.id ? 'Editar' : 'Registrar Nuevo' }} Caballo
        </ion-card-title>
        <ion-card-subtitle class="form-subtitle">
          Complete toda la informaci칩n requerida del equino
        </ion-card-subtitle>
      </ion-card-header>

      <ion-card-content class="form-content">
        <form (ngSubmit)="agregarCaballo()" class="horse-form">
          <div class="form-grid">
            <!-- Informaci칩n B치sica -->
            <div class="form-section-basic">
              <h4 class="section-label">游늶 Informaci칩n B치sica</h4>
              <ion-item class="form-item">
                <ion-input
                  label="Nombre del Caballo"
                  labelPlacement="floating"
                  [(ngModel)]="nuevoCaballo.nombre"
                  name="nombre"
                  required
                  placeholder="Ej: Rel치mpago, Bella Vista"
                  class="premium-input">
                </ion-input>
              </ion-item>

              <ion-item class="form-item">
                <ion-input
                  label="Nombre del Criadero"
                  labelPlacement="floating"
                  [(ngModel)]="nuevoCaballo.nombreCriadero"
                  name="nombreCriadero"
                  placeholder="Ej: Hacienda Los 츼lamos"
                  class="premium-input">
                </ion-input>
              </ion-item>

              <ion-item class="form-item">
                <ion-datetime
                  label="Fecha de Nacimiento"
                  labelPlacement="floating"
                  [(ngModel)]="nuevoCaballo.fechaNacimiento"
                  name="fechaNacimiento"
                  presentation="date"
                  class="premium-input">
                </ion-datetime>
              </ion-item>

              <ion-item class="form-item">
                <ion-select
                  label="Sexo"
                  labelPlacement="floating"
                  [(ngModel)]="nuevoCaballo.sexo"
                  name="sexo"
                  required
                  placeholder="Seleccionar sexo"
                  class="premium-input">
                  <ion-select-option value="macho">
                    <ion-icon name="male" slot="start"></ion-icon>
                    Macho
                  </ion-select-option>
                  <ion-select-option value="hembra">
                    <ion-icon name="female" slot="start"></ion-icon>
                    Hembra
                  </ion-select-option>
                </ion-select>
              </ion-item>
            </div>

            <!-- Caracter칤sticas F칤sicas -->
            <div class="form-section-physical">
              <h4 class="section-label">游꿛 Caracter칤sticas F칤sicas</h4>
              <ion-item class="form-item">
                <ion-input
                  label="Raza"
                  labelPlacement="floating"
                  [(ngModel)]="nuevoCaballo.raza"
                  name="raza"
                  placeholder="Ej: Pura Sangre Ingl칠s, Cuarto de Milla"
                  class="premium-input">
                </ion-input>
              </ion-item>

              <ion-item class="form-item">
                <ion-input
                  label="Pelaje"
                  labelPlacement="floating"
                  [(ngModel)]="nuevoCaballo.pelaje"
                  name="pelaje"
                  placeholder="Ej: Alaz치n, Tordo, Bayo"
                  class="premium-input">
                </ion-input>
              </ion-item>

              <ion-item class="form-item">
                <ion-select
                  label="Estado Actual"
                  labelPlacement="floating"
                  [(ngModel)]="nuevoCaballo.estado"
                  name="estado"
                  placeholder="Seleccionar estado"
                  class="premium-input">
                  <ion-select-option value="activo">
                    <ion-icon name="checkmark-circle" slot="start" color="success"></ion-icon>
                    Activo
                  </ion-select-option>
                  <ion-select-option value="inactivo">
                    <ion-icon name="pause-circle" slot="start" color="warning"></ion-icon>
                    Inactivo
                  </ion-select-option>
                  <ion-select-option value="fallecido">
                    <ion-icon name="skull" slot="start" color="danger"></ion-icon>
                    Fallecido
                  </ion-select-option>
                  <ion-select-option value="vendido">
                    <ion-icon name="cash" slot="start" color="tertiary"></ion-icon>
                    Vendido
                  </ion-select-option>
                </ion-select>
              </ion-item>
            </div>
          </div>

          <!-- Observaciones -->
          <div class="form-section-observations">
            <h4 class="section-label">游닇 Observaciones Adicionales</h4>
            <ion-item class="form-item">
              <ion-textarea
                label="Observaciones"
                labelPlacement="floating"
                [(ngModel)]="nuevoCaballo.observaciones"
                name="observaciones"
                placeholder="Informaci칩n adicional sobre el caballo, historial m칠dico, premios, etc."
                rows="4"
                class="premium-textarea">
              </ion-textarea>
            </ion-item>
          </div>

          <!-- Botones de Acci칩n -->
          <div class="form-actions">
            <ion-button
              type="submit"
              expand="block"
              color="primary"
              [disabled]="!nuevoCaballo.nombre || !nuevoCaballo.sexo"
              class="submit-button premium-glow">
              <ion-icon [name]="nuevoCaballo.id ? 'checkmark' : 'add'" slot="start"></ion-icon>
              {{ nuevoCaballo.id ? 'Actualizar' : 'Registrar' }} Caballo
            </ion-button>

            <ion-button
              fill="outline"
              expand="block"
              color="medium"
              (click)="toggleForm()"
              class="cancel-button">
              <ion-icon name="close" slot="start"></ion-icon>
              Cancelar
            </ion-button>
          </div>
        </form>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Estado Vac칤o Profesional -->
  <div class="empty-state" *ngIf="caballos.length === 0">
    <ion-card class="empty-card premium-float">
      <ion-card-content class="empty-content">
        <div class="empty-icon">
          <ion-icon name="paw-outline" size="large" color="medium"></ion-icon>
        </div>
        <h2 class="empty-title">No hay caballos registrados</h2>
        <p class="empty-description" *ngIf="canEdit">
          Comienza registrando tu primer caballo en el sistema de gesti칩n equina
        </p>
        <p class="empty-description" *ngIf="!canEdit">
          No tienes permisos para gestionar caballos. Contacta al administrador.
        </p>
        <ion-button
          *ngIf="canEdit"
          (click)="toggleForm()"
          color="primary"
          class="empty-action-button premium-glow">
          <ion-icon name="add" slot="start"></ion-icon>
          Registrar Primer Caballo
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>